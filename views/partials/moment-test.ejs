<%# Moments %>
<section class="row w-100">
  <%# Moments Navigation%>
  <div class="col-2">
    <%# Navigation %>

    <nav id="navbar-example3" class="navbar navbar-light bg-light flex-column align-items-stretch p-3">
      <nav class="nav nav-pills flex-column">
        <%# Keep track of years added to nav %>
        <% let navYears = [] %>
        <% for(let i = 0; i < momentsGrouped.length; i++) { %>
          <% const momentGroup = momentsGrouped[i] %>
  
  
          <% if(!navYears.includes(momentGroup._id.year)) { %>
            <% navYears.push(momentGroup._id.year) %>
            <a class="nav-link" href="#moment-<%= momentGroup._id.year %>"><%= momentGroup._id.year %></a>
            <nav class="nav nav-pills flex-column">
          <% } %>

          <a class="nav-link ms-3 my-1" href="#moment-<%= momentGroup._id.year %>-<%= momentGroup._id.month %>"><%= momentGroup._id.month %></a>
          
        <% } %>
        
        </nav>
      </nav>
    </nav>
  </div>
</section>

<%# Moments%>
<section class="row p-0 m-0 w-100">
  <div class="col">
    <div data-bs-spy="scroll" data-bs-target="#navbar-example3" data-bs-offset="0" tabindex="0">
      <div class="row" data-masonry='{"percentPosition": true }' style="position: relative; height: 544px;">
      
          <% for(let i = 0; i < momentsGrouped.length; i++) { %>
            <% const momentGroup = momentsGrouped[i] %>
  
  
            <div class="col-sm-6 col-lg-4 p-1" id="moment-<%= momentGroup._id.year %>">
              <div class="card">
                <div class="card-body">
                  <h5 class="card-title"><%= momentGroup._id.year %></h5>
                </div>
              </div>
            </div>
    
            <% for(let j = 0; j < momentGroup.momentData.length; j++) { %>
              <% const momentData = momentGroup.momentData[j] %>
              <% const momentType = momentData.momentType %>
    
              <%# Journal %>
              <% if(momentType === 'journal') { %>
                <div class="col-sm-6 col-lg-4 p-1" id="moment-<%= momentGroup._id.year %>-<%= momentGroup._id.month %>">
                  <div class="card">
                    <div class="card-body">
                      <h5 class="card-title"><%= momentData.date.toLocaleString('en-US', { dateStyle: 'full' }) %></h5>
                      <p class="card-text"><%= momentData.journalEntry %></p>
                    </div>
                  </div>
                </div>
              
              <%# Photo %>
              <% } else if(momentType === 'photo') { %>
                <div class="col-sm-6 col-lg-4 p-1" id="moment-<%= momentGroup._id.year %>-<%= momentGroup._id.month %>">
                  <div class="card">
                    <img src="..." class="card-img-top" alt="...">
                    <div class="card-body">
                      <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                    </div>
                  </div>
                </div>

                <%# Location %>
                <% } else if(momentType === 'location') { %>
                  <div class="col-sm-6 col-lg-4 p-1" id="moment-<%= momentGroup._id.year %>-<%= momentGroup._id.month %>">
                    <div class="card">
                      <div class="card-body">
                        This is some text within a card body.
                      </div>
                    </div>
                  </div>

                <%# Tweet %>
                <% } else if(momentType === 'twitter') { %>
                  <div class="col-sm-6 col-lg-4 p-1 h-100" id="moment-<%= momentGroup._id.year %>-<%= momentGroup._id.month %>">
                    <div id="tweet-<%= momentData.tweetId %>"></div>
                  </div>
                <% } %>
    
            <% } %>
          <% } %>
        </div>
      
    </div>
  </div>
</section>


<script type="text/javascript" src="/js/twitter.js"></script>

<% for(let i = 0; i < momentsGrouped.length; i++) { %>
  <% const momentGroup = momentsGrouped[i] %>
  <% for(let j = 0; j < momentGroup.momentData.length; j++) { %>
    <% const momentData = momentGroup.momentData[j] %>
    <% const momentType = momentData.momentType %>

    <% if(momentType === 'twitter') { %>
      <script type="text/javascript">
        TwitterWidgetsLoader.load(function(err, twttr) {
        if(err) {
          console.error(err);
          return;
        }
      
        twttr.widgets.createTweet('<%= momentData.tweetId %>', document.getElementById('tweet-<%= momentData.tweetId %>'));
      });
      </script>
    <% } %>
  <% } %>
<% } %>

<!-- Masonry -->
<script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha384-GNFwBvfVxBkLMJpYMOABq3c+d3KnQxudP/mGPkzpZSTYykLBNsZEnG2D9G/X/+7D" crossorigin="anonymous" async></script>