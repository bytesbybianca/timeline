<%- include('partials/header') -%>

<body data-bs-spy="scroll" data-bs-target="#timelineDates" data-bs-smooth-scroll="true">

<%# Modals %>
<div class="d-flex justify-content-end m-5">
  <div class="row">
    <%# New branch modal %>
    <div class="col">
      <button class="btn btn-light btn-outline-secondary btn-sm text-nowrap" data-bs-toggle="modal" data-bs-target="#newBranchModal">
        New branch
      </button>

      <div class="modal fade" id="newBranchModal">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h1>Create a new branch</h1>
              <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              <form action="/timelines/createTimeline" enctype="multipart/form-data" method="POST">
                <div class="mb-3">
                  <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                    <input type="radio" class="btn-check" name="privacy" id="public" autocomplete="off" value="public" >
                    <label class="btn btn-outline-dark" for="public">Public</label>
                  
                    <input type="radio" class="btn-check" name="privacy" id="private" autocomplete="off" value="private" checked>
                    <label class="btn btn-outline-dark" for="private">Private</label>
                  
                  </div>
                </div>
                <div class="mb-3">
                  <label for="timelineName" class="form-label">Name</label>
                  <input type="text" class="form-control" id="timelineName" name="title">
                </div>
                <div class="mb-3">
                  <label for="timelineThumb" class="form-label">Thumbnail</label>
                  <input type="file" class="form-control" id="timelineThumb" name="file">
                </div>
                <div class="mb-3">
                  <label for="description">Description:</label>
                  <textarea id="description" name="description"
                  rows="5" cols="45"></textarea>
                </div>
                <%# hidden %>
                <input id="firstDate" name="firstDate" value="" hidden>
                <input id="lastDate" name="lastDate" value="" hidden>
                <button type="submit" class="btn btn-dark btn-sm text-nowrap" value="Upload">Submit</button>
              </form>
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary btn-sm text-nowrap" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%# Info modal %>
    <div class="col">
      <button class="btn btn-light btn-outline-secondary btn-sm text-nowrap" data-bs-toggle="modal" data-bs-target="#infoModal">
        Information
      </button>

      <div class="modal fade" id="infoModal">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h1>Information</h1>
              <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
              Timeline helps you organize your favorite Moments in life by collecting them in Branches. Public branches can be viewed by others on Timeline.
            </div>
            <div class="modal-footer">
              <button class="btn btn-secondary btn-sm text-nowrap" data-bs-dismiss="modal">Close</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<%# Timeline %>
<section class="timelineWrapper row">  

    <div class="col">
      
      <div id="timelineDates" class="list-group list-group-horizontal sticky-top text-center mb-3">
        <%# loop through all groupings by same year and month%>
        <% for(let i = 0; i < timelinesGrouped.length; i++) { %>
          <% const timeGroup = timelinesGrouped[i] %>
        
          <a class="list-group-item list-group-item-action border-0" style="background-color: #F6F7FD;" href="#<% if(timeGroup._id.year) { %>group-<%= timeGroup._id.year %><% } else { %>ungrouped<% } %>">
            <% if(timeGroup._id.year) { %>
              <%= timeGroup._id.year %>
            <% } else { %>
                -
            <% } %>
          </a>
          
        <% } %>
      </div>

      <div class="scrollspy-example w-75 m-auto" tabindex="0">
        <%# loop through all groupings by same year and month%>
        <% for(let i = 0; i < timelinesGrouped.length; i++) { %>
    
        <% const timeGroup = timelinesGrouped[i] %>
        <% if(timeGroup._id.year) { %>
          <div class="row" id="group-<%= timeGroup._id.year %>">
        <% } else { %>
          <div class="row" id="ungrouped">
        <% } %>

          <%# year and month badges %>
          <div class="row mt-4 mb-2">
            <div class="col">
              <span class="badge bg-secondary"><%= timeGroup._id.year %></span>
              <% if(timeGroup.branchData[0].firstDate) { %>
                <span class="badge bg-dark"><%= timeGroup.branchData[0].firstDate.toLocaleString('en-US', { month: 'long' }) %></span>
              <% } %>
            </div>
          </div>

          <%# loop through each branch per grouping %>
          <% for(let j = 0; j < timeGroup.branchData.length; j++) { %>
            <% const branchData = timeGroup.branchData[j] %>

          <%# card %>
            <a href="/timelines/<%= branchData.branchId %>">
              <div class="card mt-2 mb-4 position-relative shadow">
                <div class="row g-0">

                  <div class="col-md-4 pr-md-0">
                    <img class="card-img-top" src="<%= branchData.timelineThumb %>" alt="Card image cap">
                  </div>

                  <div class="col-md-8 pl-md-0">
                    <div class="card-body">

                      <%# branch name %>
                      <h5 class="card-title">
                        <%= branchData.timelineName %>
                      </h5>

                      <%# description %>
                      <p class="card-text"><%= branchData.description %></p>

                      <%# Display date range in footer%>
                      <% if(branchData.firstDate) { %>
                        <h6 class="card-text">
                          <%= branchData.firstDate.toLocaleString('en-US', { dateStyle: 'full' }) %> - <%= branchData.lastDate.toLocaleString('en-US', { dateStyle: 'full' }) %>
                        </h6>
                      <% } %>

                    </div>
                  </div>
    

                </div>

                  <% if(branchData.privacy === 'private') { %>
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-dark py-1 ps-2">
                      <%= branchData.privacy %>
                      <span class="visually-hidden">private branch</span>
                    </span>
                  <% } else if(branchData.privacy === 'public') { %>
                    <span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-warning text-dark py-1 ps-2">
                      <%= branchData.privacy %>
                      <span class="visually-hidden">public branch</span>
                    </span>
                  <% } %>

              </div>
            </a>

            <% } %>
          </div>
          
        <% } %>
      </div>
    </div>
  </div>
  
</section>

<%- include('partials/footer') -%>